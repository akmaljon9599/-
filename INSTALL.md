# Инструкция по установке и запуску

## Быстрый старт

### 1. Автоматическая установка
```bash
# Запустите скрипт установки
./setup.sh
```

### 2. Ручная установка

#### Предварительные требования
- Node.js 16.0.0 или выше
- MySQL 8.0 или выше
- npm или yarn

#### Установка зависимостей
```bash
npm install
```

#### Настройка базы данных
```bash
# Создание базы данных и таблиц
mysql -u root -p < database/schema.sql

# Заполнение начальными данными
mysql -u root -p < database/seed.sql
```

#### Настройка переменных окружения
```bash
# Копирование примера конфигурации
cp .env.example .env

# Редактирование конфигурации
nano .env
```

#### Запуск приложения
```bash
# Режим разработки
npm run dev

# Продакшн режим
npm start
```

## Docker развертывание

### 1. Генерация SSL сертификатов
```bash
./generate-ssl.sh
```

### 2. Запуск с Docker Compose
```bash
# Запуск всех сервисов
docker-compose up -d

# Просмотр логов
docker-compose logs -f

# Остановка сервисов
docker-compose down
```

### 3. Настройка переменных окружения для Docker
Создайте файл `.env` с настройками:
```env
DB_PASSWORD=your_secure_password
JWT_SECRET=your_super_secret_jwt_key
YANDEX_MAPS_API_KEY=your_yandex_maps_api_key
ABS_BANK_API_KEY=your_abs_bank_api_key
```

## Доступ к приложению

После успешного запуска приложение будет доступно по адресам:
- HTTP: http://localhost
- HTTPS: https://localhost (при использовании Docker)

## Тестовые пользователи

После выполнения `database/seed.sql` будут созданы следующие тестовые пользователи:

| Роль | Логин | Пароль | Описание |
|------|-------|--------|----------|
| Администратор | admin | admin123 | Полный доступ ко всем функциям |
| Старший курьер | senior1 | courier123 | Управление курьерами и заявками |
| Курьер | courier1 | courier123 | Работа с назначенными заявками |
| Оператор | operator1 | operator123 | Создание и редактирование заявок |

## Структура проекта

```
├── backend/                 # Backend приложение
│   ├── src/
│   │   ├── controllers/     # Контроллеры API
│   │   ├── models/         # Модели данных
│   │   ├── routes/         # Маршруты API
│   │   ├── middleware/     # Middleware функции
│   │   ├── services/       # Бизнес-логика
│   │   └── utils/          # Утилиты
│   ├── config/             # Конфигурация
│   └── uploads/            # Загруженные файлы
├── frontend/               # Frontend приложение
│   ├── css/               # Стили
│   ├── js/                # JavaScript
│   └── images/            # Изображения
├── database/              # База данных
│   ├── schema.sql         # Схема БД
│   └── seed.sql           # Начальные данные
└── docs/                  # Документация
```

## API Endpoints

### Аутентификация
- `POST /api/auth/login` - Вход в систему
- `POST /api/auth/logout` - Выход из системы
- `GET /api/auth/me` - Информация о текущем пользователе

### Заявки
- `GET /api/requests` - Список заявок с фильтрацией
- `POST /api/requests` - Создание новой заявки
- `GET /api/requests/:id` - Получение заявки по ID
- `PUT /api/requests/:id` - Обновление заявки
- `POST /api/requests/:id/status` - Изменение статуса заявки

### Курьеры
- `GET /api/couriers` - Список курьеров
- `GET /api/couriers/:id/location` - Текущее местоположение курьера
- `GET /api/couriers/realtime/locations` - Курьеры в реальном времени

### Файлы
- `POST /api/files/upload` - Загрузка файлов
- `GET /api/files/:id` - Получение файла
- `DELETE /api/files/:id` - Удаление файла

## Настройка интеграций

### Яндекс.Карты
1. Получите API ключ на https://developer.tech.yandex.ru/
2. Добавьте ключ в `.env` файл:
   ```
   YANDEX_MAPS_API_KEY=your_api_key_here
   ```

### АБС банка
1. Настройте API шлюз банка
2. Добавьте настройки в `.env` файл:
   ```
   ABS_BANK_API_URL=https://api.abs-bank.com
   ABS_BANK_API_KEY=your_api_key_here
   ```

## Мониторинг и логирование

Логи приложения сохраняются в директории `backend/logs/`:
- `error.log` - Ошибки
- `warn.log` - Предупреждения
- `info.log` - Информационные сообщения
- `debug.log` - Отладочная информация

## Безопасность

- Все пароли хешируются с помощью bcrypt
- JWT токены для аутентификации
- Rate limiting для защиты от DDoS
- Валидация всех входных данных
- CORS настройки
- Helmet для безопасности заголовков

## Резервное копирование

### База данных
```bash
# Создание резервной копии
mysqldump -u root -p courier_system > backup_$(date +%Y%m%d_%H%M%S).sql

# Восстановление из резервной копии
mysql -u root -p courier_system < backup_file.sql
```

### Файлы
```bash
# Архивирование загруженных файлов
tar -czf uploads_backup_$(date +%Y%m%d_%H%M%S).tar.gz backend/uploads/
```

## Обновление системы

1. Остановите приложение
2. Создайте резервную копию базы данных
3. Обновите код
4. Установите новые зависимости: `npm install`
5. Выполните миграции (если есть)
6. Запустите приложение

## Устранение неполадок

### Проблемы с подключением к базе данных
1. Проверьте настройки в `.env` файле
2. Убедитесь, что MySQL запущен
3. Проверьте права доступа пользователя

### Проблемы с загрузкой файлов
1. Проверьте права доступа к директории `backend/uploads/`
2. Убедитесь, что размер файла не превышает лимит

### Проблемы с WebSocket
1. Проверьте настройки CORS
2. Убедитесь, что порт не заблокирован файрволом

## Поддержка

При возникновении проблем:
1. Проверьте логи приложения
2. Убедитесь, что все зависимости установлены
3. Проверьте настройки переменных окружения
4. Обратитесь к документации API

## Лицензия

MIT License