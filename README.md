# Система управления курьерскими заявками

Комплексная система для управления заявками на доставку банковских карт с разграничением прав доступа по ролям пользователей.

## Технологический стек

- **Frontend**: HTML5, CSS3, JavaScript (Bootstrap 5, FontAwesome)
- **Backend**: PHP 7.4+
- **База данных**: MySQL 5.7+
- **Карты**: Яндекс.Карты API
- **Интеграции**: АБС банка, Amazon S3 (для файлов)

## Роли пользователей

### Администратор
- Полный доступ ко всем функциям системы
- Управление пользователями и правами доступа
- Настройка системы
- Просмотр всех заявок и отчетности
- Мониторинг местоположения курьеров

### Старший курьер
- Просмотр заявок своего филиала/подразделения
- Назначение и переназначение курьеров
- Печать договоров оферты
- Управление курьерами в подразделении
- Изменение статусов заявок

### Курьер
- Просмотр назначенных заявок
- Изменение статуса на "Доставлено" или "Отказано"
- Загрузка фотографий при доставке
- Автоматическая отправка геолокации

### Оператор
- Добавление и редактирование заявок
- Просмотр заявок
- Использование фильтров
- Выгрузка данных в Excel

## Установка и настройка

### Требования
- PHP 7.4 или выше
- MySQL 5.7 или выше
- Apache/Nginx веб-сервер
- Расширения PHP: PDO, PDO_MySQL, GD, cURL

### Шаги установки

1. **Клонирование проекта**
   ```bash
   git clone <repository-url>
   cd courier-system
   ```

2. **Настройка базы данных**
   ```bash
   mysql -u root -p < database/schema.sql
   ```

3. **Настройка конфигурации**
   ```bash
   cp .env.example .env
   # Отредактируйте .env файл с вашими настройками
   ```

4. **Настройка веб-сервера**
   
   Для Apache создайте `.htaccess` в корне проекта:
   ```apache
   RewriteEngine On
   RewriteCond %{REQUEST_FILENAME} !-f
   RewriteCond %{REQUEST_FILENAME} !-d
   RewriteRule ^backend/api/(.*)$ backend/api/index.php [QSA,L]
   ```

   Для Nginx добавьте в конфигурацию:
   ```nginx
   location /backend/api/ {
       try_files $uri $uri/ /backend/api/index.php?$query_string;
   }
   ```

5. **Настройка прав доступа**
   ```bash
   chmod -R 755 uploads/
   chmod -R 755 logs/
   ```

### Первый вход

Используйте учетные данные администратора по умолчанию:
- **Логин**: admin
- **Пароль**: admin123

⚠️ **Обязательно измените пароль после первого входа!**

## API Endpoints

### Аутентификация
- `POST /backend/api/auth/login` - Вход в систему
- `POST /backend/api/auth/logout` - Выход из системы
- `GET /backend/api/auth/me` - Получить данные текущего пользователя
- `PUT /backend/api/auth/profile` - Обновить профиль
- `POST /backend/api/auth/change-password` - Изменить пароль

### Заявки
- `GET /backend/api/requests` - Получить список заявок
- `GET /backend/api/requests/{id}` - Получить заявку по ID
- `POST /backend/api/requests` - Создать заявку
- `PUT /backend/api/requests/{id}` - Обновить заявку
- `POST /backend/api/requests/{id}/update-status` - Изменить статус
- `POST /backend/api/requests/{id}/assign-courier` - Назначить курьера
- `GET /backend/api/requests/export` - Экспорт в Excel
- `GET /backend/api/requests/statistics` - Статистика заявок

### Курьеры
- `GET /backend/api/couriers` - Список курьеров
- `GET /backend/api/couriers/online` - Онлайн курьеры
- `GET /backend/api/couriers/map` - Курьеры для карты
- `POST /backend/api/couriers/{id}/location` - Обновить местоположение
- `POST /backend/api/couriers/{id}/status` - Изменить онлайн статус

### Загрузка файлов
- `POST /backend/api/upload/photo` - Загрузить фото
- `POST /backend/api/upload/document` - Загрузить документ
- `POST /backend/api/upload/signature` - Сохранить подпись

### Дашборд
- `GET /backend/api/dashboard` - Статистика для дашборда

## Структура проекта

```
courier-system/
├── backend/
│   ├── api/
│   │   └── index.php          # Главный роутер API
│   ├── config/
│   │   ├── app.php            # Конфигурация приложения
│   │   ├── database.php       # Настройки БД
│   │   └── Database.php       # Класс для работы с БД
│   ├── controllers/           # Контроллеры API
│   ├── middleware/            # Middleware (авторизация)
│   └── models/               # Модели данных
├── database/
│   └── schema.sql            # Схема базы данных
├── frontend/
│   ├── css/                  # Стили
│   ├── js/                   # JavaScript файлы
│   └── pages/               # HTML страницы
├── uploads/                  # Загруженные файлы
│   ├── documents/
│   ├── photos/
│   └── signatures/
├── logs/                     # Логи системы
├── .env.example             # Пример конфигурации
└── фронт тест.html          # Главная страница
```

## Функциональность

### Основные возможности
- ✅ Управление заявками с полным жизненным циклом
- ✅ Разграничение прав доступа по ролям
- ✅ Отслеживание местоположения курьеров в реальном времени
- ✅ Загрузка и управление документами
- ✅ Электронная подпись клиентов
- ✅ Система фильтрации и поиска
- ✅ Экспорт данных в Excel
- ✅ Интеграция с Яндекс.Картами
- ✅ Мобильно-адаптивный интерфейс

### Безопасность
- JWT аутентификация
- Хеширование паролей
- Защита от CSRF атак
- Валидация и санитизация входных данных
- Логирование действий пользователей
- Ограничение количества попыток входа

### Мониторинг и логирование
- Логи действий пользователей
- Логи ошибок системы
- История изменений заявок
- Отслеживание местоположения курьеров

## Интеграции

### Яндекс.Карты
1. Получите API ключ на [developer.tech.yandex.ru](https://developer.tech.yandex.ru)
2. Добавьте ключ в `.env` файл: `YANDEX_MAPS_API_KEY=your-key`
3. Карты будут автоматически загружены при открытии соответствующих разделов

### АБС банка
Подготовлена структура для интеграции с АБС банка:
- Настройте `ABS_API_ENDPOINT` и `ABS_API_KEY` в `.env`
- Реализуйте методы интеграции в соответствующих контроллерах

## Разработка

### Добавление новых API endpoints
1. Создайте метод в соответствующем контроллере
2. Добавьте маршрут в `backend/api/index.php`
3. Обновите документацию

### Добавление новых ролей
1. Добавьте роль в таблицу `roles`
2. Обновите проверки прав в `AuthMiddleware`
3. Обновите интерфейс для новой роли

### Тестирование API
Используйте инструменты типа Postman или cURL для тестирования API endpoints.

Пример запроса авторизации:
```bash
curl -X POST http://localhost/backend/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

## Поддержка

При возникновении проблем:
1. Проверьте логи в папке `logs/`
2. Убедитесь в правильности настроек в `.env`
3. Проверьте права доступа к папкам `uploads/` и `logs/`

## Лицензия

Этот проект разработан для внутреннего использования банка.

## Версия

Текущая версия: 1.0.0
Дата релиза: Сентябрь 2025